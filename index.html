import React, { useState, useRef, useEffect } from 'react';
import { Send, Bot, User, X, MessageCircle, Minimize2, Globe, Moon, Sun, Mic, MicOff, Download, Sparkles } from 'lucide-react';

const VantageHallChatbot = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [language, setLanguage] = useState('en');
  const [darkMode, setDarkMode] = useState(false);
  const [isListening, setIsListening] = useState(false);
  const [userName, setUserName] = useState('');
  const [showNameInput, setShowNameInput] = useState(true);
  const messagesEndRef = useRef(null);
  const inputRef = useRef(null);
  const recognitionRef = useRef(null);

  const campusImages = {
    building: 'https://images.unsplash.com/photo-1562774053-701939374585?w=800',
    library: 'https://images.unsplash.com/photo-1521587760476-6c12a4b040da?w=800',
    sports: 'https://images.unsplash.com/photo-1551958219-acbc608c6377?w=800',
    hostel: 'https://images.unsplash.com/photo-1555854877-bab0e564b8d5?w=800',
    classroom: 'https://images.unsplash.com/photo-1427504494785-3a9ca7044f45?w=800',
    lab: 'https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=800',
    dining: 'https://images.unsplash.com/photo-1567521464027-f127ff144326?w=800',
    playground: 'https://images.unsplash.com/photo-1530549387789-4c1017266635?w=800'
  };

  const translations = {
    en: {
      welcome: (name) => `Hello ${name}! üëã Welcome to Vantage Hall Girls' Residential School. I'm your AI assistant. How can I help you today?`,
      placeholder: "Ask me anything (((((((((demo))))))about the school...",
      quickQuestions: "Quick Questions:",
      typing: "AI is thinking...",
      namePrompt: "What's your name?",
      startChat: "Start Chat"
    },
    hi: {
      welcome: (name) => `‡§®‡§Æ‡§∏‡•ç‡§§‡•á ${name}! üëã Vantage Hall Girls' Residential School ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Ç‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Ç?`,
      placeholder: "‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§™‡•Ç‡§õ‡•á‡§Ç...",
      quickQuestions: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®:",
      typing: "AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...",
      namePrompt: "‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",
      startChat: "‡§ö‡•à‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç"
    }
  };

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, isTyping]);

  useEffect(() => {
    if (isOpen && !showNameInput && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen, showNameInput]);

  useEffect(() => {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognitionRef.current = new SpeechRecognition();
      recognitionRef.current.continuous = false;
      recognitionRef.current.interimResults = false;
      recognitionRef.current.lang = language === 'hi' ? 'hi-IN' : 'en-US';

      recognitionRef.current.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        setInputText(transcript);
        setIsListening(false);
      };

      recognitionRef.current.onerror = () => {
        setIsListening(false);
      };

      recognitionRef.current.onend = () => {
        setIsListening(false);
      };
    }
  }, [language]);

  const startNameChat = () => {
    if (!userName.trim()) return;
    setShowNameInput(false);
    setMessages([{
      type: 'bot',
      text: translations[language].welcome(userName),
      time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
    }]);
  };

  const knowledgeBase = {
    en: {
      greeting: {
        keywords: ['hi', 'hello', 'hey', 'good morning', 'good evening', 'namaste'],
        response: `Hello! üòä Great to hear from you! I'm here to answer all your questions about Vantage Hall.

How can I assist you today? You can ask me about:
‚Ä¢ üéì Admissions & Eligibility
‚Ä¢ üí∞ Fees & Payment Plans
‚Ä¢ üè† Hostel Life & Facilities
‚Ä¢ üìö Academics & Curriculum
‚Ä¢ ‚öΩ Sports & Activities
‚Ä¢ üçΩÔ∏è Food & Nutrition
‚Ä¢ üì∏ Campus Photos & Virtual Tour`
      },
      campus: {
        keywords: ['campus', 'photo', 'picture', 'image', 'tour', 'building', 'infrastructure', 'facility', 'look', 'show'],
        response: {
          text: `üè´ **Our Beautiful Campus!**

Vantage Hall is spread across a magnificent campus in Dehradun with:

‚ú® Modern Academic Blocks
üìö State-of-the-art Library
üî¨ Advanced Science Labs
üíª Computer Labs with latest tech
üèÉ‚Äç‚ôÄÔ∏è Olympic-size Sports Complex
üèä‚Äç‚ôÄÔ∏è Swimming Pool
üé® Art & Music Studios
üå≥ Lush Green Gardens

Want to see more? Ask me for specific photos like "show me library" or "sports facilities"!`,
          images: [campusImages.building, campusImages.playground]
        }
      },
      library: {
        keywords: ['library', 'books', 'reading', 'study room'],
        response: {
          text: `üìö **Our World-Class Library**

Our library is a knowledge paradise with:
‚Ä¢ 15,000+ books collection
‚Ä¢ Digital library with e-books
‚Ä¢ Peaceful reading zones
‚Ä¢ Study cubicles for focused learning
‚Ä¢ Latest magazines & journals
‚Ä¢ Comfortable seating arrangements

Open: 6:00 AM - 9:00 PM daily`,
          images: [campusImages.library, campusImages.classroom]
        }
      },
      sports_photos: {
        keywords: ['sports photo', 'playground', 'ground', 'swimming', 'gym'],
        response: {
          text: `‚öΩ **Our Sports Facilities**

We have world-class sports infrastructure:
üèè Cricket Ground | ‚öΩ Football Field
üèÄ Basketball Courts | üèê Volleyball Courts
üèä‚Äç‚ôÄÔ∏è Olympic Swimming Pool | üí™ Modern Gymnasium
üéæ Tennis Courts | üè∏ Badminton Courts

All facilities maintained to international standards with professional coaching!`,
          images: [campusImages.sports, campusImages.playground]
        }
      },
      hostel_photos: {
        keywords: ['hostel photo', 'room', 'dormitory', 'accommodation photo'],
        response: {
          text: `üè† **Comfortable Hostel Living**

Our hostels provide a home away from home:
‚Ä¢ Spacious, well-ventilated rooms
‚Ä¢ Comfortable beds with storage
‚Ä¢ Study tables & reading lamps
‚Ä¢ 24/7 security & CCTV
‚Ä¢ Clean bathrooms & toilets
‚Ä¢ Common rooms for recreation
‚Ä¢ Separate blocks for different age groups

Safe, secure, and comfortable! üõ°Ô∏è`,
          images: [campusImages.hostel, campusImages.dining]
        }
      },
      contact: {
        keywords: ['contact', 'phone', 'email', 'address', 'location', 'where', 'reach', 'call', 'visit'],
        response: `üìç **Get In Touch With Us**

**School Address:**
The Yellow Brick Road, Doonga
Dehradun - 248007, Uttarakhand

**General Queries:**
üìß Email: info@vantagehall.org
üìû Phone: 0135-2776225, 226, 227, 228

**Admissions Team:**
üìß Email: admissions@vantagehall.org
üìû Phone: +91-8191912999
üìû Phone: +91-7078311863

**Office Hours:** Mon-Sat, 9:00 AM - 5:00 PM

We're always happy to help! üòä`
      },
      admission: {
        keywords: ['admission', 'enroll', 'join', 'apply', 'process', 'how to apply', 'registration'],
        response: `üéì **Admission Process - Simple & Transparent**

**Step-by-Step Guide:**

1Ô∏è‚É£ **Registration** (Sept-Oct)
   ‚Ä¢ Fill online application form
   ‚Ä¢ Pay registration fee: ‚Çπ10,000

2Ô∏è‚É£ **Entrance Test**
   ‚Ä¢ English, Mathematics, Science
   ‚Ä¢ Age-appropriate difficulty level

3Ô∏è‚É£ **Personal Interview**
   ‚Ä¢ Meeting with Principal
   ‚Ä¢ Interaction with Director

4Ô∏è‚É£ **Selection & Admission**
   ‚Ä¢ Results within 7 days
   ‚Ä¢ Document submission
   ‚Ä¢ Fee payment & joining

**Eligibility:**
‚úÖ Classes 3-12 (Age as per CBSE)
‚úÖ Good academic record
‚úÖ Transfer Certificate from previous school

üìû Call now: +91-8191912999`
      },
      fees: {
        keywords: ['fee', 'fees', 'cost', 'price', 'charges', 'payment', 'tuition', 'expensive'],
        response: `üí∞ **Complete Fee Structure**

**Classes 3-7:** ‚Çπ7,35,000 (First Year)
‚îú‚îÄ Annual: ‚Çπ5,50,000
‚îî‚îÄ One-time: ‚Çπ1,85,000

**Classes 8-10:** ‚Çπ8,35,000 (First Year)
‚îú‚îÄ Annual: ‚Çπ6,50,000
‚îî‚îÄ One-time: ‚Çπ1,85,000

**Classes 11-12:** ‚Çπ8,85,000 (First Year)
‚îú‚îÄ Annual: ‚Çπ7,00,000
‚îî‚îÄ One-time: ‚Çπ1,85,000

**Includes:**
‚úÖ Boarding & Lodging
‚úÖ All Meals
‚úÖ Academics & Study Material
‚úÖ Sports & Activities
‚úÖ Medical Facilities
‚úÖ Laundry Service
‚úÖ Wi-Fi Access

**Payment Plans Available!** üí≥
üìû Contact: admissions@vantagehall.org`
      },
      hostel: {
        keywords: ['hostel', 'boarding', 'facilities', 'room', 'accommodation', 'residential', 'stay'],
        response: `üè† **Premium Hostel Experience**

**Room Facilities:**
üõèÔ∏è Comfortable beds
ü™ë Study table & chair
üëï Spacious wardrobe
üí° Reading lamps
ü™ü Well-ventilated rooms

**Common Facilities:**
‚úÖ 24/7 Security & CCTV
‚úÖ Trained House Mothers
‚úÖ Medical Room
‚úÖ Common Room (TV, Games)
‚úÖ Hot Water 24/7
‚úÖ Clean Washrooms
‚úÖ Laundry Service (3x week)
‚úÖ Wi-Fi (Controlled Hours)

**Safety:**
üõ°Ô∏è Biometric Entry
üîí Restricted Access
üìû Emergency Contact
üö® Fire Safety

Want to see hostel photos? Just ask! üì∏`
      },
      food: {
        keywords: ['food', 'meal', 'dining', 'menu', 'breakfast', 'lunch', 'dinner', 'diet'],
        response: `üçΩÔ∏è **Nutritious & Delicious Meals**

**Daily Schedule:**

üåÖ **Breakfast (7:00 AM)**
‚Ä¢ Fresh Fruits & Juices
‚Ä¢ Cereals, Milk, Eggs
‚Ä¢ Parathas/Dosa/Pancakes

üçõ **Lunch (1:00 PM)**
‚Ä¢ Dal & Rice/Roti
‚Ä¢ 2 Vegetable Dishes
‚Ä¢ Salad & Dessert

üç≤ **Dinner (7:30 PM)**
‚Ä¢ Similar to lunch
‚Ä¢ Weekly special dishes

ü•õ **Night Milk (9:30 PM)**
‚Ä¢ Mandatory for all students

**Features:**
‚úÖ Nutritionist-planned menus
‚úÖ Veg & Non-veg options
‚úÖ Special diets available
‚úÖ FSSAI certified
‚úÖ Menu rotation every 15 days

Sample menu: vantagehall.org/food-nutrition`
      },
      sports: {
        keywords: ['sport', 'sports', 'games', 'athletics', 'physical', 'exercise'],
        response: `‚öΩ **World-Class Sports Program**

**Outdoor Sports:**
üèè Cricket | ‚öΩ Football | üèÄ Basketball
üèê Volleyball | üéæ Tennis | üè∏ Badminton

**Indoor Sports:**
üèì Table Tennis | ‚ôüÔ∏è Chess

**Fitness:**
üí™ Modern Gymnasium
üèä‚Äç‚ôÄÔ∏è Swimming Pool (Olympic size)
üßò‚Äç‚ôÄÔ∏è Yoga Hall

**We Offer:**
‚úÖ Professional Coaches
‚úÖ Inter-house Competitions
‚úÖ Sports Science Guidance
‚úÖ Physiotherapy Support

**Achievements:**
üèÜ State Champions in Cricket (2023)
üèÜ National Level Swimmers

Want to see facilities? Ask for photos! üì∏`
      },
      default: {
        response: `I'm your AI assistant for Vantage Hall! ü§ñ‚ú®

I can help you with:

üìç **General:** Contact, Location, Timings
üéì **Admissions:** Process, Documents
üí∞ **Fees:** Structure, Payment
üè† **Hostel:** Facilities, Safety
üçΩÔ∏è **Food:** Menu, Nutrition
‚öΩ **Sports:** Facilities, Coaching
üìö **Academics:** Curriculum, Streams
üì∏ **Campus:** Photos, Tour

**Try asking:**
‚Ä¢ "Show me campus photos"
‚Ä¢ "What's the admission process?"
‚Ä¢ "Tell me about sports facilities"
‚Ä¢ "How is the food?"

Type your question! üòä`
      }
    },
    hi: {
      greeting: {
        keywords: ['hi', 'hello', 'namaste', 'namaskar'],
        response: `‡§®‡§Æ‡§∏‡•ç‡§§‡•á! üòä ‡§Æ‡•à‡§Ç Vantage Hall ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§≠‡•Ä ‡§∏‡§µ‡§æ‡§≤‡•ã‡§Ç ‡§ï‡§æ ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Ç‡•§

‡§Ü‡§ú ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Ç?
‚Ä¢ üéì ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§î‡§∞ ‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ
‚Ä¢ üí∞ ‡§∂‡•Å‡§≤‡•ç‡§ï ‡§î‡§∞ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®
‚Ä¢ üè† ‡§õ‡§æ‡§§‡•ç‡§∞‡§æ‡§µ‡§æ‡§∏ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç
‚Ä¢ üìö ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§î‡§∞ ‡§™‡§æ‡§†‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ
‚Ä¢ ‚öΩ ‡§ñ‡•á‡§≤ ‡§î‡§∞ ‡§ó‡§§‡§ø‡§µ‡§ø‡§ß‡§ø‡§Ø‡§æ‡§Ç
‚Ä¢ üçΩÔ∏è ‡§≠‡•ã‡§ú‡§® ‡§î‡§∞ ‡§™‡•ã‡§∑‡§£
‚Ä¢ üì∏ ‡§ï‡•à‡§Ç‡§™‡§∏ ‡§´‡•ã‡§ü‡•ã`
      },
      campus: {
        keywords: ['campus', 'photo', 'tasveer', 'dikhaiye', 'building'],
        response: {
          text: `üè´ **‡§π‡§Æ‡§æ‡§∞‡§æ ‡§∏‡•Å‡§Ç‡§¶‡§∞ ‡§™‡§∞‡§ø‡§∏‡§∞!**

Vantage Hall ‡§¶‡•á‡§π‡§∞‡§æ‡§¶‡•Ç‡§® ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§®‡§¶‡§æ‡§∞ ‡§™‡§∞‡§ø‡§∏‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡•à:

‚ú® ‡§Ü‡§ß‡•Å‡§®‡§ø‡§ï ‡§∂‡•à‡§ï‡•ç‡§∑‡§£‡§ø‡§ï ‡§≠‡§µ‡§®
üìö ‡§Ö‡§§‡•ç‡§Ø‡§æ‡§ß‡•Å‡§®‡§ø‡§ï ‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§æ‡§≤‡§Ø
üî¨ ‡§â‡§®‡•ç‡§®‡§§ ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§® ‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§∂‡§æ‡§≤‡§æ‡§è‡§Ç
üíª ‡§ï‡§Ç‡§™‡•ç‡§Ø‡•Ç‡§ü‡§∞ ‡§≤‡•à‡§¨
üèÉ‚Äç‚ôÄÔ∏è ‡§ñ‡•á‡§≤ ‡§™‡§∞‡§ø‡§∏‡§∞
üèä‚Äç‚ôÄÔ∏è ‡§∏‡•ç‡§µ‡§ø‡§Æ‡§ø‡§Ç‡§ó ‡§™‡•Ç‡§≤
üé® ‡§ï‡§≤‡§æ ‡§∏‡•ç‡§ü‡•Ç‡§°‡§ø‡§Ø‡•ã
üå≥ ‡§π‡§∞‡•á ‡§¨‡§ó‡•Ä‡§ö‡•á

‡§î‡§∞ ‡§¶‡•á‡§ñ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? ‡§Æ‡•Å‡§ù‡§∏‡•á ‡§™‡•Ç‡§õ‡•á‡§Ç!`,
          images: [campusImages.building, campusImages.playground]
        }
      },
      contact: {
        keywords: ['contact', 'sampark', 'phone', 'number', 'pata', 'address'],
        response: `üìç **‡§π‡§Æ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç**

**‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§ï‡§æ ‡§™‡§§‡§æ:**
The Yellow Brick Road, Doonga
Dehradun - 248007, Uttarakhand

**‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§∂‡•ç‡§®:**
üìß Email: info@vantagehall.org
üìû Phone: 0135-2776225, 226, 227, 228

**‡§™‡•ç‡§∞‡§µ‡•á‡§∂:**
üìß Email: admissions@vantagehall.org
üìû Phone: +91-8191912999

**‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø:** ‡§∏‡•ã‡§Æ-‡§∂‡§®‡§ø, 9:00 AM - 5:00 PM

‡§π‡§Æ ‡§Æ‡§¶‡§¶ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡§Ç! üòä`
      },
      admission: {
        keywords: ['admission', 'pravesh', 'davhla', 'kaise'],
        response: `üéì **‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ**

1Ô∏è‚É£ **‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£** (‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞-‡§Ö‡§ï‡•ç‡§ü‡•Ç‡§¨‡§∞)
   ‚Ä¢ ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§´‡•â‡§∞‡•ç‡§Æ ‡§≠‡§∞‡•á‡§Ç
   ‚Ä¢ ‡§∂‡•Å‡§≤‡•ç‡§ï: ‚Çπ10,000

2Ô∏è‚É£ **‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ**
   ‚Ä¢ ‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡•Ä, ‡§ó‡§£‡§ø‡§§, ‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®

3Ô∏è‚É£ **‡§∏‡§æ‡§ï‡•ç‡§∑‡§æ‡§§‡•ç‡§ï‡§æ‡§∞**
   ‚Ä¢ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§∏‡§ø‡§™‡§≤ ‡§ï‡•á ‡§∏‡§æ‡§•
   ‚Ä¢ ‡§°‡§æ‡§Ø‡§∞‡•á‡§ï‡•ç‡§ü‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§•

4Ô∏è‚É£ **‡§ö‡§Ø‡§®**
   ‚Ä¢ 7 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ

**‡§™‡§æ‡§§‡•ç‡§∞‡§§‡§æ:**
‚úÖ ‡§ï‡§ï‡•ç‡§∑‡§æ 3-12
‚úÖ ‡§Ö‡§ö‡•ç‡§õ‡§æ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§°
‚úÖ ‡§∏‡•ç‡§•‡§æ‡§®‡§æ‡§Ç‡§§‡§∞‡§£ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£ ‡§™‡§§‡•ç‡§∞

üìû ‡§ï‡•â‡§≤ ‡§ï‡§∞‡•á‡§Ç: +91-8191912999`
      },
      fees: {
        keywords: ['fee', 'shulk', 'kitna', 'charges'],
        response: `üí∞ **‡§∂‡•Å‡§≤‡•ç‡§ï ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ**

**‡§ï‡§ï‡•ç‡§∑‡§æ 3-7:** ‚Çπ7,35,000
**‡§ï‡§ï‡•ç‡§∑‡§æ 8-10:** ‚Çπ8,35,000
**‡§ï‡§ï‡•ç‡§∑‡§æ 11-12:** ‚Çπ8,85,000

**‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à:**
‚úÖ ‡§Ü‡§µ‡§æ‡§∏
‚úÖ ‡§∏‡§≠‡•Ä ‡§≠‡•ã‡§ú‡§®
‚úÖ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ
‚úÖ ‡§ñ‡•á‡§≤
‚úÖ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ
‚úÖ ‡§≤‡•â‡§®‡•ç‡§°‡•ç‡§∞‡•Ä
‚úÖ Wi-Fi

üìû ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï: admissions@vantagehall.org`
      },
      default: {
        response: `‡§Æ‡•à‡§Ç Vantage Hall AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•Ç‡§Ç! ü§ñ‚ú®

‡§Æ‡•à‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Ç:

üìç ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä
üéì ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ
üí∞ ‡§∂‡•Å‡§≤‡•ç‡§ï ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ
üè† ‡§õ‡§æ‡§§‡•ç‡§∞‡§æ‡§µ‡§æ‡§∏ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç
üçΩÔ∏è ‡§≠‡•ã‡§ú‡§® ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ
‚öΩ ‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç
üì∏ ‡§ï‡•à‡§Ç‡§™‡§∏ ‡§´‡•ã‡§ü‡•ã

‡§Ö‡§™‡§®‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§™‡•Ç‡§õ‡•á‡§Ç! üòä`
      }
    }
  };

  const quickQuestions = {
    en: [
      "üìç Contact Details",
      "üéì Admission Process",
      "üí∞ Fee Structure",
      "üè† Hostel Facilities",
      "üì∏ Show Campus Photos",
      "‚öΩ Sports Facilities"
    ],
    hi: [
      "üìç ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§µ‡§ø‡§µ‡§∞‡§£",
      "üéì ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ",
      "üí∞ ‡§∂‡•Å‡§≤‡•ç‡§ï ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ",
      "üè† ‡§õ‡§æ‡§§‡•ç‡§∞‡§æ‡§µ‡§æ‡§∏",
      "üì∏ ‡§ï‡•à‡§Ç‡§™‡§∏ ‡§´‡•ã‡§ü‡•ã",
      "‚öΩ ‡§ñ‡•á‡§≤ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Ç"
    ]
  };

  const findResponse = (query) => {
    const lowerQuery = query.toLowerCase();
    const kb = knowledgeBase[language];
    
    for (const [key, value] of Object.entries(kb)) {
      if (key !== 'default' && value.keywords.some(keyword => lowerQuery.includes(keyword))) {
        return value.response;
      }
    }
    return kb.default.response;
  };

  const handleSend = () => {
    if (!inputText.trim()) return;

    const userMessage = {
      type: 'user',
      text: inputText,
      time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');
    setIsTyping(true);

    setTimeout(() => {
      const botResponse = findResponse(inputText);
      const responseText = typeof botResponse === 'object' ? botResponse.text : botResponse;
      const responseImages = typeof botResponse === 'object' ? botResponse.images : [];
      
      const botMessage = {
        type: 'bot',
        text: responseText,
        images: responseImages || [],
        time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
      };
      setMessages(prev => [...prev, botMessage]);
      setIsTyping(false);
    }, 1500);
  };

  const handleQuickQuestion = (question) => {
    setInputText(question);
    setTimeout(() => handleSend(), 100);
  };

  const toggleLanguage = () => {
    setLanguage(prev => prev === 'en' ? 'hi' : 'en');
  };

  const toggleDarkMode = () => {
    setDarkMode(prev => !prev);
  };

  const startVoiceInput = () => {
    if (recognitionRef.current && !isListening) {
      setIsListening(true);
      recognitionRef.current.start();
    } else if (recognitionRef.current && isListening) {
      setIsListening(false);
      recognitionRef.current.stop();
    }
  };

  const downloadChat = () => {
    const chatText = messages.map(msg => 
      `${msg.type === 'user' ? userName : 'Vantage Hall AI'} [${msg.time}]:\n${msg.text}\n\n`
    ).join('');
    
    const blob = new Blob([chatText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `vantage-hall-chat-${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="fixed bottom-6 right-6 z-50 font-sans">
      {!isOpen ? (
        <button
          onClick={() => setIsOpen(true)}
          className="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 hover:from-purple-700 hover:via-pink-700 hover:to-red-700 text-white rounded-full p-5 shadow-2xl transition-all duration-300 transform hover:scale-110 flex items-center gap-3 group animate-pulse hover:animate-none"
        >
          <Sparkles className="w-7 h-7" />
          <span className="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 whitespace-nowrap font-semibold">
            Chat with AI! ü§ñ
          </span>
        </button>
      ) : (
        <div className={`${darkMode ? 'bg-gray-900 border-gray-700' : 'bg-white'} rounded-3xl shadow-2xl w-[420px] h-[650px] flex flex-col overflow-hidden transition-all duration-300 border-2 ${darkMode ? 'border-purple-800' : 'border-purple-200'}`}>
          <div className={`${darkMode ? 'bg-gradient-to-r from-purple-900 via-pink-900 to-red-900' : 'bg-gradient-to-r from-purple-600 via-pink-600 to-red-600'} text-white p-4 flex items-center justify-between`}>
            <div className="flex items-center gap-3">
              <div className="bg-white rounded-full p-2.5 animate-pulse">
                <Bot className="w-7 h-7 text-purple-600" />
              </div>
              <div>
                <h3 className="font-bold text-lg flex items-center gap-2">
                  Vantage Hall AI
                  <Sparkles className="w-4 h-4 animate-spin" style={{ animationDuration: '3s' }} />
                </h3>
                <p className="text-xs opacity-90 flex items-center gap-1">
                  <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                  Always Ready to Help
                </p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={toggleLanguage}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
                title={language === 'en' ? '‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç' : 'Switch to English'}
              >
                <Globe className="w-5 h-5" />
              </button>
              <button
                onClick={toggleDarkMode}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
              >
                {darkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
              </button>
              <button
                onClick={downloadChat}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
              >
                <Download className="w-5 h-5" />
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
              >
                <Minimize2 className="w-5 h-5" />
              </button>
            </div>
          </div>

          {showNameInput ? (
            <div className={`flex-1 flex items-center justify-center p-8 ${darkMode ? 'bg-gray-800' : 'bg-gradient-to-br from-purple-50 to-pink-50'}`}>
              <div className="text-center max-w-sm">
                <div className="mb-6">
                  <div className="inline-block p-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full mb-4">
                    <User className="w-12 h-12 text-white" />
                  </div>
                  <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-2`}>
                    {translations[language].namePrompt}
                  </h2>
                  <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                    {language === 'en' ? 'Let me personalize your experience' : '‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§ï‡•ã ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§¨‡§®‡§æ‡§ä‡§Ç'}
                  </p>
                </div>
                <input
                  type="text"
                  value={userName}
                  onChange={(e) => setUserName(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && startNameChat()}
                  placeholder={language === 'en' ? 'Enter your name...' : '‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç...'}
                  className={`w-full ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'} border-2 rounded-xl px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all text-center text-lg`}
                  autoFocus
                />
                <button
                  onClick={startNameChat}
                  disabled={!userName.trim()}
                  className={`w-full ${darkMode ? 'bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700' : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-300'} text-white font-semibold rounded-xl py-3 transition-all transform hover:scale-105 disabled:transform-none disabled:cursor-not-allowed flex items-center justify-center gap-2`}
                >
                  <MessageCircle className="w-5 h-5" />
                  {translations[language].startChat}
                </button>
              </div>
            </div>
          ) : (
            <>
              <div className={`flex-1 overflow-y-auto p-4 space-y-4 ${darkMode ? 'bg-gray-800' : 'bg-gradient-to-b from-gray-50 to-purple-50'}`}>
                {messages.map((msg, idx) => (
                  <div key={idx} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`flex gap-2 max-w-[85%] ${msg.type === 'user' ? 'flex-row-reverse' : ''}`}>
                      <div className={`${msg.type === 'bot' ? darkMode ? 'bg-purple-900' : 'bg-gradient-to-br from-purple-100 to-pink-100' : darkMode ? 'bg-gray-700' : 'bg-white'} rounded-full p-2 h-10 w-10 flex items-center justify-center flex-shrink-0 shadow-md`}>
                        {msg.type === 'bot' ? (
                          <Bot className={`w-5 h-5 ${darkMode ? 'text-purple-300' : 'text-purple-600'}`} />
                        ) : (
                          <User className={`w-5 h-5 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`} />
                        )}
                      </div>
                      <div className="flex flex-col">
                        <div className={`${msg.type === 'bot' ? darkMode ? 'bg-gray-700 text-gray-100' : 'bg-white text-gray-800' : darkMode ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white' : 'bg-gradient-to-r from-purple-600 to-pink-600 text-white'} rounded-2xl p-4 shadow-lg whitespace-pre-line`}>
                          {msg.text}
                          {msg.images && msg.images.length > 0 && (
                            <div className="mt-3 grid grid-cols-2 gap-2">
                              {msg.images.map((img, imgIdx) => (
                                <img 
                                  key={imgIdx}
                                  src={img} 
                                  alt={`Campus ${imgIdx + 1}`}
                                  className="rounded-lg w-full h-32 object-cover shadow-md hover:scale-105 transition-transform cursor-pointer"
                                  onClick={() => window.open(img, '_blank')}
                                />
                              ))}
                            </div>
                          )}
                        </div>
                        <span className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'} mt-1 ${msg.type === 'user' ? 'text-right' : 'text-left'}`}>
                          {msg.time}
                        </span>
                      </div>
                    </div>
                  </div>
                ))}
                
                {isTyping && (
                  <div className="flex justify-start">
                    <div className="flex gap-2 max-w-[85%]">
                      <div className={`${darkMode ? 'bg-purple-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} rounded-full p-2 h-10 w-10 flex items-center justify-center flex-shrink-0 shadow-md`}>
                        <Bot className={`w-5 h-5 ${darkMode ? 'text-purple-300' : 'text-purple-600'} animate-bounce`} />
                      </div>
                      <div className={`${darkMode ? 'bg-gray-700' : 'bg-white'} rounded-2xl p-4 shadow-lg`}>
                        <div className="flex gap-1.5">
                          <div className={`w-2.5 h-2.5 ${darkMode ? 'bg-purple-400' : 'bg-purple-600'} rounded-full animate-bounce`} style={{ animationDelay: '0ms' }}></div>
                          <div className={`w-2.5 h-2.5 ${darkMode ? 'bg-purple-400' : 'bg-purple-600'} rounded-full animate-bounce`} style={{ animationDelay: '150ms' }}></div>
                          <div className={`w-2.5 h-2.5 ${darkMode ? 'bg-purple-400' : 'bg-purple-600'} rounded-full animate-bounce`} style={{ animationDelay: '300ms' }}></div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                <div ref={messagesEndRef} />
              </div>

              {messages.length === 1 && (
                <div className={`p-3 ${darkMode ? 'bg-gray-800' : 'bg-white'} border-t ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                  <p className={`text-xs font-semibold ${darkMode ? 'text-gray-400' : 'text-gray-500'} mb-2 flex items-center gap-1`}>
                    <Sparkles className="w-3 h-3" />
                    {translations[language].quickQuestions}
                  </p>
                  <div className="flex flex-wrap gap-2">
                    {quickQuestions[language].map((question, idx) => (
                      <button
                        key={idx}
                        onClick={() => handleQuickQuestion(question)}
                        className={`text-xs ${darkMode ? 'bg-gray-700 hover:bg-purple-700 text-gray-200' : 'bg-gradient-to-r from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 text-gray-700'} px-3 py-2 rounded-full border ${darkMode ? 'border-gray-600' : 'border-purple-200'} transition-all transform hover:scale-105 shadow-sm font-medium`}
                      >
                        {question}
                      </button>
                    ))}
                  </div>
                </div>
              )}

              <div className={`p-4 ${darkMode ? 'bg-gray-900 border-gray-700' : 'bg-white border-gray-200'} border-t-2`}>
                <div className="flex gap-2 items-center">
                  <input
                    ref={inputRef}
                    type="text"
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                    placeholder={translations[language].placeholder}
                    className={`flex-1 ${darkMode ? 'bg-gray-800 border-gray-700 text-gray-100 placeholder-gray-500' : 'bg-gray-50 border-gray-300 text-gray-800 placeholder-gray-400'} border-2 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 ${darkMode ? 'focus:ring-purple-500' : 'focus:ring-purple-400'} transition-all`}
                  />
                  {('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) && (
                    <button
                      onClick={startVoiceInput}
                      className={`${isListening ? 'bg-red-500 animate-pulse' : darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} ${darkMode ? 'text-white' : 'text-gray-700'} rounded-xl p-3 transition-all transform hover:scale-105`}
                    >
                      {isListening ? <MicOff className="w-5 h-5" /> : <Mic className="w-5 h-5" />}
                    </button>
                  )}
                  <button
                    onClick={handleSend}
                    disabled={!inputText.trim()}
                    className={`${darkMode ? 'bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700' : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-300'} text-white rounded-xl p-3 transition-all transform hover:scale-105 disabled:transform-none disabled:cursor-not-allowed shadow-lg`}
                  >
                    <Send className="w-5 h-5" />
                  </button>
                </div>
                <div className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'} mt-2 text-center flex items-center justify-center gap-1`}>
                  <Sparkles className="w-3 h-3" />
                  Powered by AI 
                </div>
              </div>
            </>
          )}
        </div>
      )}
    </div>
  );
};

export default VantageHallChatbot;
