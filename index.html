import React, { useState, useRef, useEffect } from 'react';
import { Send, Bot, User, X, MessageCircle, Minimize2, Globe, Moon, Sun, Mic, MicOff, Download, Sparkles } from 'lucide-react';

const VantageHallChatbot = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState([]);
  const [inputText, setInputText] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const [language, setLanguage] = useState('en');
  const [darkMode, setDarkMode] = useState(false);
  const [isListening, setIsListening] = useState(false);
  const [userName, setUserName] = useState('');
  const [showNameInput, setShowNameInput] = useState(true);
  const messagesEndRef = useRef(null);
  const inputRef = useRef(null);
  const recognitionRef = useRef(null);

  const campusImages = {
    building: 'https://images.unsplash.com/photo-1562774053-701939374585?w=800',
    library: 'https://images.unsplash.com/photo-1521587760476-6c12a4b040da?w=800',
    sports: 'https://images.unsplash.com/photo-1551958219-acbc608c6377?w=800',
    hostel: 'https://images.unsplash.com/photo-1555854877-bab0e564b8d5?w=800',
    classroom: 'https://images.unsplash.com/photo-1427504494785-3a9ca7044f45?w=800',
    lab: 'https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=800',
    dining: 'https://images.unsplash.com/photo-1567521464027-f127ff144326?w=800',
    playground: 'https://images.unsplash.com/photo-1530549387789-4c1017266635?w=800'
  };

  const translations = {
    en: {
      welcome: (name) => `Hello ${name}! 👋 Welcome to Vantage Hall Girls' Residential School. I'm your AI assistant. How can I help you today?`,
      placeholder: "Ask me anything (((((((((demo))))))about the school...",
      quickQuestions: "Quick Questions:",
      typing: "AI is thinking...",
      namePrompt: "What's your name?",
      startChat: "Start Chat"
    },
    hi: {
      welcome: (name) => `नमस्ते ${name}! 👋 Vantage Hall Girls' Residential School में आपका स्वागत है। मैं आपका AI सहायक हूं। मैं आपकी कैसे मदद कर सकती हूं?`,
      placeholder: "स्कूल के बारे में कुछ भी पूछें...",
      quickQuestions: "त्वरित प्रश्न:",
      typing: "AI सोच रहा है...",
      namePrompt: "आपका नाम क्या है?",
      startChat: "चैट शुरू करें"
    }
  };

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages, isTyping]);

  useEffect(() => {
    if (isOpen && !showNameInput && inputRef.current) {
      inputRef.current.focus();
    }
  }, [isOpen, showNameInput]);

  useEffect(() => {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognitionRef.current = new SpeechRecognition();
      recognitionRef.current.continuous = false;
      recognitionRef.current.interimResults = false;
      recognitionRef.current.lang = language === 'hi' ? 'hi-IN' : 'en-US';

      recognitionRef.current.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        setInputText(transcript);
        setIsListening(false);
      };

      recognitionRef.current.onerror = () => {
        setIsListening(false);
      };

      recognitionRef.current.onend = () => {
        setIsListening(false);
      };
    }
  }, [language]);

  const startNameChat = () => {
    if (!userName.trim()) return;
    setShowNameInput(false);
    setMessages([{
      type: 'bot',
      text: translations[language].welcome(userName),
      time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
    }]);
  };

  const knowledgeBase = {
    en: {
      greeting: {
        keywords: ['hi', 'hello', 'hey', 'good morning', 'good evening', 'namaste'],
        response: `Hello! 😊 Great to hear from you! I'm here to answer all your questions about Vantage Hall.

How can I assist you today? You can ask me about:
• 🎓 Admissions & Eligibility
• 💰 Fees & Payment Plans
• 🏠 Hostel Life & Facilities
• 📚 Academics & Curriculum
• ⚽ Sports & Activities
• 🍽️ Food & Nutrition
• 📸 Campus Photos & Virtual Tour`
      },
      campus: {
        keywords: ['campus', 'photo', 'picture', 'image', 'tour', 'building', 'infrastructure', 'facility', 'look', 'show'],
        response: {
          text: `🏫 **Our Beautiful Campus!**

Vantage Hall is spread across a magnificent campus in Dehradun with:

✨ Modern Academic Blocks
📚 State-of-the-art Library
🔬 Advanced Science Labs
💻 Computer Labs with latest tech
🏃‍♀️ Olympic-size Sports Complex
🏊‍♀️ Swimming Pool
🎨 Art & Music Studios
🌳 Lush Green Gardens

Want to see more? Ask me for specific photos like "show me library" or "sports facilities"!`,
          images: [campusImages.building, campusImages.playground]
        }
      },
      library: {
        keywords: ['library', 'books', 'reading', 'study room'],
        response: {
          text: `📚 **Our World-Class Library**

Our library is a knowledge paradise with:
• 15,000+ books collection
• Digital library with e-books
• Peaceful reading zones
• Study cubicles for focused learning
• Latest magazines & journals
• Comfortable seating arrangements

Open: 6:00 AM - 9:00 PM daily`,
          images: [campusImages.library, campusImages.classroom]
        }
      },
      sports_photos: {
        keywords: ['sports photo', 'playground', 'ground', 'swimming', 'gym'],
        response: {
          text: `⚽ **Our Sports Facilities**

We have world-class sports infrastructure:
🏏 Cricket Ground | ⚽ Football Field
🏀 Basketball Courts | 🏐 Volleyball Courts
🏊‍♀️ Olympic Swimming Pool | 💪 Modern Gymnasium
🎾 Tennis Courts | 🏸 Badminton Courts

All facilities maintained to international standards with professional coaching!`,
          images: [campusImages.sports, campusImages.playground]
        }
      },
      hostel_photos: {
        keywords: ['hostel photo', 'room', 'dormitory', 'accommodation photo'],
        response: {
          text: `🏠 **Comfortable Hostel Living**

Our hostels provide a home away from home:
• Spacious, well-ventilated rooms
• Comfortable beds with storage
• Study tables & reading lamps
• 24/7 security & CCTV
• Clean bathrooms & toilets
• Common rooms for recreation
• Separate blocks for different age groups

Safe, secure, and comfortable! 🛡️`,
          images: [campusImages.hostel, campusImages.dining]
        }
      },
      contact: {
        keywords: ['contact', 'phone', 'email', 'address', 'location', 'where', 'reach', 'call', 'visit'],
        response: `📍 **Get In Touch With Us**

**School Address:**
The Yellow Brick Road, Doonga
Dehradun - 248007, Uttarakhand

**General Queries:**
📧 Email: info@vantagehall.org
📞 Phone: 0135-2776225, 226, 227, 228

**Admissions Team:**
📧 Email: admissions@vantagehall.org
📞 Phone: +91-8191912999
📞 Phone: +91-7078311863

**Office Hours:** Mon-Sat, 9:00 AM - 5:00 PM

We're always happy to help! 😊`
      },
      admission: {
        keywords: ['admission', 'enroll', 'join', 'apply', 'process', 'how to apply', 'registration'],
        response: `🎓 **Admission Process - Simple & Transparent**

**Step-by-Step Guide:**

1️⃣ **Registration** (Sept-Oct)
   • Fill online application form
   • Pay registration fee: ₹10,000

2️⃣ **Entrance Test**
   • English, Mathematics, Science
   • Age-appropriate difficulty level

3️⃣ **Personal Interview**
   • Meeting with Principal
   • Interaction with Director

4️⃣ **Selection & Admission**
   • Results within 7 days
   • Document submission
   • Fee payment & joining

**Eligibility:**
✅ Classes 3-12 (Age as per CBSE)
✅ Good academic record
✅ Transfer Certificate from previous school

📞 Call now: +91-8191912999`
      },
      fees: {
        keywords: ['fee', 'fees', 'cost', 'price', 'charges', 'payment', 'tuition', 'expensive'],
        response: `💰 **Complete Fee Structure**

**Classes 3-7:** ₹7,35,000 (First Year)
├─ Annual: ₹5,50,000
└─ One-time: ₹1,85,000

**Classes 8-10:** ₹8,35,000 (First Year)
├─ Annual: ₹6,50,000
└─ One-time: ₹1,85,000

**Classes 11-12:** ₹8,85,000 (First Year)
├─ Annual: ₹7,00,000
└─ One-time: ₹1,85,000

**Includes:**
✅ Boarding & Lodging
✅ All Meals
✅ Academics & Study Material
✅ Sports & Activities
✅ Medical Facilities
✅ Laundry Service
✅ Wi-Fi Access

**Payment Plans Available!** 💳
📞 Contact: admissions@vantagehall.org`
      },
      hostel: {
        keywords: ['hostel', 'boarding', 'facilities', 'room', 'accommodation', 'residential', 'stay'],
        response: `🏠 **Premium Hostel Experience**

**Room Facilities:**
🛏️ Comfortable beds
🪑 Study table & chair
👕 Spacious wardrobe
💡 Reading lamps
🪟 Well-ventilated rooms

**Common Facilities:**
✅ 24/7 Security & CCTV
✅ Trained House Mothers
✅ Medical Room
✅ Common Room (TV, Games)
✅ Hot Water 24/7
✅ Clean Washrooms
✅ Laundry Service (3x week)
✅ Wi-Fi (Controlled Hours)

**Safety:**
🛡️ Biometric Entry
🔒 Restricted Access
📞 Emergency Contact
🚨 Fire Safety

Want to see hostel photos? Just ask! 📸`
      },
      food: {
        keywords: ['food', 'meal', 'dining', 'menu', 'breakfast', 'lunch', 'dinner', 'diet'],
        response: `🍽️ **Nutritious & Delicious Meals**

**Daily Schedule:**

🌅 **Breakfast (7:00 AM)**
• Fresh Fruits & Juices
• Cereals, Milk, Eggs
• Parathas/Dosa/Pancakes

🍛 **Lunch (1:00 PM)**
• Dal & Rice/Roti
• 2 Vegetable Dishes
• Salad & Dessert

🍲 **Dinner (7:30 PM)**
• Similar to lunch
• Weekly special dishes

🥛 **Night Milk (9:30 PM)**
• Mandatory for all students

**Features:**
✅ Nutritionist-planned menus
✅ Veg & Non-veg options
✅ Special diets available
✅ FSSAI certified
✅ Menu rotation every 15 days

Sample menu: vantagehall.org/food-nutrition`
      },
      sports: {
        keywords: ['sport', 'sports', 'games', 'athletics', 'physical', 'exercise'],
        response: `⚽ **World-Class Sports Program**

**Outdoor Sports:**
🏏 Cricket | ⚽ Football | 🏀 Basketball
🏐 Volleyball | 🎾 Tennis | 🏸 Badminton

**Indoor Sports:**
🏓 Table Tennis | ♟️ Chess

**Fitness:**
💪 Modern Gymnasium
🏊‍♀️ Swimming Pool (Olympic size)
🧘‍♀️ Yoga Hall

**We Offer:**
✅ Professional Coaches
✅ Inter-house Competitions
✅ Sports Science Guidance
✅ Physiotherapy Support

**Achievements:**
🏆 State Champions in Cricket (2023)
🏆 National Level Swimmers

Want to see facilities? Ask for photos! 📸`
      },
      default: {
        response: `I'm your AI assistant for Vantage Hall! 🤖✨

I can help you with:

📍 **General:** Contact, Location, Timings
🎓 **Admissions:** Process, Documents
💰 **Fees:** Structure, Payment
🏠 **Hostel:** Facilities, Safety
🍽️ **Food:** Menu, Nutrition
⚽ **Sports:** Facilities, Coaching
📚 **Academics:** Curriculum, Streams
📸 **Campus:** Photos, Tour

**Try asking:**
• "Show me campus photos"
• "What's the admission process?"
• "Tell me about sports facilities"
• "How is the food?"

Type your question! 😊`
      }
    },
    hi: {
      greeting: {
        keywords: ['hi', 'hello', 'namaste', 'namaskar'],
        response: `नमस्ते! 😊 मैं Vantage Hall के बारे में सभी सवालों का जवाब देने के लिए यहाँ हूं।

आज मैं आपकी कैसे मदद कर सकती हूं?
• 🎓 प्रवेश और पात्रता
• 💰 शुल्क और भुगतान
• 🏠 छात्रावास सुविधाएं
• 📚 शिक्षा और पाठ्यक्रम
• ⚽ खेल और गतिविधियां
• 🍽️ भोजन और पोषण
• 📸 कैंपस फोटो`
      },
      campus: {
        keywords: ['campus', 'photo', 'tasveer', 'dikhaiye', 'building'],
        response: {
          text: `🏫 **हमारा सुंदर परिसर!**

Vantage Hall देहरादून में शानदार परिसर में है:

✨ आधुनिक शैक्षणिक भवन
📚 अत्याधुनिक पुस्तकालय
🔬 उन्नत विज्ञान प्रयोगशालाएं
💻 कंप्यूटर लैब
🏃‍♀️ खेल परिसर
🏊‍♀️ स्विमिंग पूल
🎨 कला स्टूडियो
🌳 हरे बगीचे

और देखना चाहते हैं? मुझसे पूछें!`,
          images: [campusImages.building, campusImages.playground]
        }
      },
      contact: {
        keywords: ['contact', 'sampark', 'phone', 'number', 'pata', 'address'],
        response: `📍 **हमसे संपर्क करें**

**स्कूल का पता:**
The Yellow Brick Road, Doonga
Dehradun - 248007, Uttarakhand

**सामान्य प्रश्न:**
📧 Email: info@vantagehall.org
📞 Phone: 0135-2776225, 226, 227, 228

**प्रवेश:**
📧 Email: admissions@vantagehall.org
📞 Phone: +91-8191912999

**कार्यालय:** सोम-शनि, 9:00 AM - 5:00 PM

हम मदद के लिए तैयार हैं! 😊`
      },
      admission: {
        keywords: ['admission', 'pravesh', 'davhla', 'kaise'],
        response: `🎓 **प्रवेश प्रक्रिया**

1️⃣ **पंजीकरण** (सितंबर-अक्टूबर)
   • ऑनलाइन फॉर्म भरें
   • शुल्क: ₹10,000

2️⃣ **परीक्षा**
   • अंग्रेजी, गणित, विज्ञान

3️⃣ **साक्षात्कार**
   • प्रिंसिपल के साथ
   • डायरेक्टर के साथ

4️⃣ **चयन**
   • 7 दिनों में परिणाम

**पात्रता:**
✅ कक्षा 3-12
✅ अच्छा रिकॉर्ड
✅ स्थानांतरण प्रमाण पत्र

📞 कॉल करें: +91-8191912999`
      },
      fees: {
        keywords: ['fee', 'shulk', 'kitna', 'charges'],
        response: `💰 **शुल्क संरचना**

**कक्षा 3-7:** ₹7,35,000
**कक्षा 8-10:** ₹8,35,000
**कक्षा 11-12:** ₹8,85,000

**शामिल है:**
✅ आवास
✅ सभी भोजन
✅ शिक्षा
✅ खेल
✅ चिकित्सा
✅ लॉन्ड्री
✅ Wi-Fi

📞 संपर्क: admissions@vantagehall.org`
      },
      default: {
        response: `मैं Vantage Hall AI सहायक हूं! 🤖✨

मैं मदद कर सकती हूं:

📍 संपर्क जानकारी
🎓 प्रवेश प्रक्रिया
💰 शुल्क संरचना
🏠 छात्रावास सुविधाएं
🍽️ भोजन व्यवस्था
⚽ खेल सुविधाएं
📸 कैंपस फोटो

अपना सवाल पूछें! 😊`
      }
    }
  };

  const quickQuestions = {
    en: [
      "📍 Contact Details",
      "🎓 Admission Process",
      "💰 Fee Structure",
      "🏠 Hostel Facilities",
      "📸 Show Campus Photos",
      "⚽ Sports Facilities"
    ],
    hi: [
      "📍 संपर्क विवरण",
      "🎓 प्रवेश प्रक्रिया",
      "💰 शुल्क संरचना",
      "🏠 छात्रावास",
      "📸 कैंपस फोटो",
      "⚽ खेल सुविधाएं"
    ]
  };

  const findResponse = (query) => {
    const lowerQuery = query.toLowerCase();
    const kb = knowledgeBase[language];
    
    for (const [key, value] of Object.entries(kb)) {
      if (key !== 'default' && value.keywords.some(keyword => lowerQuery.includes(keyword))) {
        return value.response;
      }
    }
    return kb.default.response;
  };

  const handleSend = () => {
    if (!inputText.trim()) return;

    const userMessage = {
      type: 'user',
      text: inputText,
      time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
    };

    setMessages(prev => [...prev, userMessage]);
    setInputText('');
    setIsTyping(true);

    setTimeout(() => {
      const botResponse = findResponse(inputText);
      const responseText = typeof botResponse === 'object' ? botResponse.text : botResponse;
      const responseImages = typeof botResponse === 'object' ? botResponse.images : [];
      
      const botMessage = {
        type: 'bot',
        text: responseText,
        images: responseImages || [],
        time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
      };
      setMessages(prev => [...prev, botMessage]);
      setIsTyping(false);
    }, 1500);
  };

  const handleQuickQuestion = (question) => {
    setInputText(question);
    setTimeout(() => handleSend(), 100);
  };

  const toggleLanguage = () => {
    setLanguage(prev => prev === 'en' ? 'hi' : 'en');
  };

  const toggleDarkMode = () => {
    setDarkMode(prev => !prev);
  };

  const startVoiceInput = () => {
    if (recognitionRef.current && !isListening) {
      setIsListening(true);
      recognitionRef.current.start();
    } else if (recognitionRef.current && isListening) {
      setIsListening(false);
      recognitionRef.current.stop();
    }
  };

  const downloadChat = () => {
    const chatText = messages.map(msg => 
      `${msg.type === 'user' ? userName : 'Vantage Hall AI'} [${msg.time}]:\n${msg.text}\n\n`
    ).join('');
    
    const blob = new Blob([chatText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `vantage-hall-chat-${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="fixed bottom-6 right-6 z-50 font-sans">
      {!isOpen ? (
        <button
          onClick={() => setIsOpen(true)}
          className="bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 hover:from-purple-700 hover:via-pink-700 hover:to-red-700 text-white rounded-full p-5 shadow-2xl transition-all duration-300 transform hover:scale-110 flex items-center gap-3 group animate-pulse hover:animate-none"
        >
          <Sparkles className="w-7 h-7" />
          <span className="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 whitespace-nowrap font-semibold">
            Chat with AI! 🤖
          </span>
        </button>
      ) : (
        <div className={`${darkMode ? 'bg-gray-900 border-gray-700' : 'bg-white'} rounded-3xl shadow-2xl w-[420px] h-[650px] flex flex-col overflow-hidden transition-all duration-300 border-2 ${darkMode ? 'border-purple-800' : 'border-purple-200'}`}>
          <div className={`${darkMode ? 'bg-gradient-to-r from-purple-900 via-pink-900 to-red-900' : 'bg-gradient-to-r from-purple-600 via-pink-600 to-red-600'} text-white p-4 flex items-center justify-between`}>
            <div className="flex items-center gap-3">
              <div className="bg-white rounded-full p-2.5 animate-pulse">
                <Bot className="w-7 h-7 text-purple-600" />
              </div>
              <div>
                <h3 className="font-bold text-lg flex items-center gap-2">
                  Vantage Hall AI
                  <Sparkles className="w-4 h-4 animate-spin" style={{ animationDuration: '3s' }} />
                </h3>
                <p className="text-xs opacity-90 flex items-center gap-1">
                  <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                  Always Ready to Help
                </p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button
                onClick={toggleLanguage}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
                title={language === 'en' ? 'हिंदी में बदलें' : 'Switch to English'}
              >
                <Globe className="w-5 h-5" />
              </button>
              <button
                onClick={toggleDarkMode}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
              >
                {darkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
              </button>
              <button
                onClick={downloadChat}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
              >
                <Download className="w-5 h-5" />
              </button>
              <button
                onClick={() => setIsOpen(false)}
                className="p-2 hover:bg-white/20 rounded-lg transition-all transform hover:scale-110"
              >
                <Minimize2 className="w-5 h-5" />
              </button>
            </div>
          </div>

          {showNameInput ? (
            <div className={`flex-1 flex items-center justify-center p-8 ${darkMode ? 'bg-gray-800' : 'bg-gradient-to-br from-purple-50 to-pink-50'}`}>
              <div className="text-center max-w-sm">
                <div className="mb-6">
                  <div className="inline-block p-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full mb-4">
                    <User className="w-12 h-12 text-white" />
                  </div>
                  <h2 className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-2`}>
                    {translations[language].namePrompt}
                  </h2>
                  <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                    {language === 'en' ? 'Let me personalize your experience' : 'मैं आपके अनुभव को व्यक्तिगत बनाऊं'}
                  </p>
                </div>
                <input
                  type="text"
                  value={userName}
                  onChange={(e) => setUserName(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && startNameChat()}
                  placeholder={language === 'en' ? 'Enter your name...' : 'अपना नाम लिखें...'}
                  className={`w-full ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-300 text-gray-800'} border-2 rounded-xl px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all text-center text-lg`}
                  autoFocus
                />
                <button
                  onClick={startNameChat}
                  disabled={!userName.trim()}
                  className={`w-full ${darkMode ? 'bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700' : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-300'} text-white font-semibold rounded-xl py-3 transition-all transform hover:scale-105 disabled:transform-none disabled:cursor-not-allowed flex items-center justify-center gap-2`}
                >
                  <MessageCircle className="w-5 h-5" />
                  {translations[language].startChat}
                </button>
              </div>
            </div>
          ) : (
            <>
              <div className={`flex-1 overflow-y-auto p-4 space-y-4 ${darkMode ? 'bg-gray-800' : 'bg-gradient-to-b from-gray-50 to-purple-50'}`}>
                {messages.map((msg, idx) => (
                  <div key={idx} className={`flex ${msg.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`flex gap-2 max-w-[85%] ${msg.type === 'user' ? 'flex-row-reverse' : ''}`}>
                      <div className={`${msg.type === 'bot' ? darkMode ? 'bg-purple-900' : 'bg-gradient-to-br from-purple-100 to-pink-100' : darkMode ? 'bg-gray-700' : 'bg-white'} rounded-full p-2 h-10 w-10 flex items-center justify-center flex-shrink-0 shadow-md`}>
                        {msg.type === 'bot' ? (
                          <Bot className={`w-5 h-5 ${darkMode ? 'text-purple-300' : 'text-purple-600'}`} />
                        ) : (
                          <User className={`w-5 h-5 ${darkMode ? 'text-gray-300' : 'text-gray-600'}`} />
                        )}
                      </div>
                      <div className="flex flex-col">
                        <div className={`${msg.type === 'bot' ? darkMode ? 'bg-gray-700 text-gray-100' : 'bg-white text-gray-800' : darkMode ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white' : 'bg-gradient-to-r from-purple-600 to-pink-600 text-white'} rounded-2xl p-4 shadow-lg whitespace-pre-line`}>
                          {msg.text}
                          {msg.images && msg.images.length > 0 && (
                            <div className="mt-3 grid grid-cols-2 gap-2">
                              {msg.images.map((img, imgIdx) => (
                                <img 
                                  key={imgIdx}
                                  src={img} 
                                  alt={`Campus ${imgIdx + 1}`}
                                  className="rounded-lg w-full h-32 object-cover shadow-md hover:scale-105 transition-transform cursor-pointer"
                                  onClick={() => window.open(img, '_blank')}
                                />
                              ))}
                            </div>
                          )}
                        </div>
                        <span className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'} mt-1 ${msg.type === 'user' ? 'text-right' : 'text-left'}`}>
                          {msg.time}
                        </span>
                      </div>
                    </div>
                  </div>
                ))}
                
                {isTyping && (
                  <div className="flex justify-start">
                    <div className="flex gap-2 max-w-[85%]">
                      <div className={`${darkMode ? 'bg-purple-900' : 'bg-gradient-to-br from-purple-100 to-pink-100'} rounded-full p-2 h-10 w-10 flex items-center justify-center flex-shrink-0 shadow-md`}>
                        <Bot className={`w-5 h-5 ${darkMode ? 'text-purple-300' : 'text-purple-600'} animate-bounce`} />
                      </div>
                      <div className={`${darkMode ? 'bg-gray-700' : 'bg-white'} rounded-2xl p-4 shadow-lg`}>
                        <div className="flex gap-1.5">
                          <div className={`w-2.5 h-2.5 ${darkMode ? 'bg-purple-400' : 'bg-purple-600'} rounded-full animate-bounce`} style={{ animationDelay: '0ms' }}></div>
                          <div className={`w-2.5 h-2.5 ${darkMode ? 'bg-purple-400' : 'bg-purple-600'} rounded-full animate-bounce`} style={{ animationDelay: '150ms' }}></div>
                          <div className={`w-2.5 h-2.5 ${darkMode ? 'bg-purple-400' : 'bg-purple-600'} rounded-full animate-bounce`} style={{ animationDelay: '300ms' }}></div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                <div ref={messagesEndRef} />
              </div>

              {messages.length === 1 && (
                <div className={`p-3 ${darkMode ? 'bg-gray-800' : 'bg-white'} border-t ${darkMode ? 'border-gray-700' : 'border-gray-200'}`}>
                  <p className={`text-xs font-semibold ${darkMode ? 'text-gray-400' : 'text-gray-500'} mb-2 flex items-center gap-1`}>
                    <Sparkles className="w-3 h-3" />
                    {translations[language].quickQuestions}
                  </p>
                  <div className="flex flex-wrap gap-2">
                    {quickQuestions[language].map((question, idx) => (
                      <button
                        key={idx}
                        onClick={() => handleQuickQuestion(question)}
                        className={`text-xs ${darkMode ? 'bg-gray-700 hover:bg-purple-700 text-gray-200' : 'bg-gradient-to-r from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 text-gray-700'} px-3 py-2 rounded-full border ${darkMode ? 'border-gray-600' : 'border-purple-200'} transition-all transform hover:scale-105 shadow-sm font-medium`}
                      >
                        {question}
                      </button>
                    ))}
                  </div>
                </div>
              )}

              <div className={`p-4 ${darkMode ? 'bg-gray-900 border-gray-700' : 'bg-white border-gray-200'} border-t-2`}>
                <div className="flex gap-2 items-center">
                  <input
                    ref={inputRef}
                    type="text"
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                    placeholder={translations[language].placeholder}
                    className={`flex-1 ${darkMode ? 'bg-gray-800 border-gray-700 text-gray-100 placeholder-gray-500' : 'bg-gray-50 border-gray-300 text-gray-800 placeholder-gray-400'} border-2 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 ${darkMode ? 'focus:ring-purple-500' : 'focus:ring-purple-400'} transition-all`}
                  />
                  {('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) && (
                    <button
                      onClick={startVoiceInput}
                      className={`${isListening ? 'bg-red-500 animate-pulse' : darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} ${darkMode ? 'text-white' : 'text-gray-700'} rounded-xl p-3 transition-all transform hover:scale-105`}
                    >
                      {isListening ? <MicOff className="w-5 h-5" /> : <Mic className="w-5 h-5" />}
                    </button>
                  )}
                  <button
                    onClick={handleSend}
                    disabled={!inputText.trim()}
                    className={`${darkMode ? 'bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700' : 'bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-300'} text-white rounded-xl p-3 transition-all transform hover:scale-105 disabled:transform-none disabled:cursor-not-allowed shadow-lg`}
                  >
                    <Send className="w-5 h-5" />
                  </button>
                </div>
                <div className={`text-xs ${darkMode ? 'text-gray-500' : 'text-gray-400'} mt-2 text-center flex items-center justify-center gap-1`}>
                  <Sparkles className="w-3 h-3" />
                  Powered by AI 
                </div>
              </div>
            </>
          )}
        </div>
      )}
    </div>
  );
};

export default VantageHallChatbot;
